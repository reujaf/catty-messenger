{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}import React,{useState,useEffect}from'react';import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import FlatList from\"react-native-web/dist/exports/FlatList\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import TextInput from\"react-native-web/dist/exports/TextInput\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import{getDatabase,ref,onValue,push,set}from'firebase/database';import{getAuth}from'firebase/auth';import{database}from'../config/firebase';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";var HomeScreen=function HomeScreen(_ref){var navigation=_ref.navigation;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),chats=_useState2[0],setChats=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),searchQuery=_useState6[0],setSearchQuery=_useState6[1];useEffect(function(){var auth=getAuth();var currentUser=auth.currentUser;if(!currentUser){navigation.navigate('Login');return;}var chatsRef=ref(database,'chats');var unsubscribe=onValue(chatsRef,function(snapshot){var data=snapshot.val();if(data){var chatList=Object.entries(data).filter(function(_ref2){var _ref3=_slicedToArray(_ref2,2),_=_ref3[0],chat=_ref3[1];return chat.participants&&chat.participants[currentUser.uid];}).map(function(_ref4){var _ref5=_slicedToArray(_ref4,2),id=_ref5[0],chat=_ref5[1];return _objectSpread(_objectSpread({id:id},chat),{},{lastMessage:chat.messages?Object.values(chat.messages).pop():null});}).sort(function(a,b){if(!a.lastMessage||!b.lastMessage)return 0;return b.lastMessage.timestamp-a.lastMessage.timestamp;});setChats(chatList);}else{setChats([]);}setLoading(false);});return function(){return unsubscribe();};},[navigation]);var filteredChats=chats.filter(function(chat){return chat.participants&&Object.values(chat.participants).some(function(user){return user.email&&user.email.toLowerCase().includes(searchQuery.toLowerCase());});});var renderChatItem=function renderChatItem(_ref6){var item=_ref6.item;var auth=getAuth();var currentUser=auth.currentUser;var otherUser=Object.values(item.participants).find(function(user){return user.uid!==currentUser.uid;});return _jsx(TouchableOpacity,{className:\"bg-surface border-b border-gray-200 p-4\",onPress:function onPress(){return navigation.navigate('Chat',{chatId:item.id,otherUser:otherUser});},children:_jsxs(View,{className:\"flex-row justify-between items-center\",children:[_jsxs(View,{className:\"flex-1\",children:[_jsx(Text,{className:\"text-lg font-semibold text-gray-900\",children:(otherUser==null?void 0:otherUser.email)||'Unknown User'}),item.lastMessage&&_jsx(Text,{className:\"text-gray-600 mt-1\",children:item.lastMessage.text})]}),item.lastMessage&&_jsx(Text,{className:\"text-gray-400 text-sm\",children:new Date(item.lastMessage.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})})]})});};if(loading){return _jsx(View,{className:\"flex-1 justify-center items-center bg-surface\",children:_jsx(ActivityIndicator,{size:\"large\",color:\"#007AFF\"})});}return _jsxs(View,{className:\"flex-1 bg-surface\",children:[_jsx(View,{className:\"p-4\",children:_jsx(TextInput,{className:\"bg-background border border-gray-300 rounded-lg px-4 py-3\",placeholder:\"Sohbet Ara...\",value:searchQuery,onChangeText:setSearchQuery})}),_jsx(FlatList,{data:filteredChats,renderItem:renderChatItem,keyExtractor:function keyExtractor(item){return item.id;},ListEmptyComponent:_jsx(View,{className:\"flex-1 justify-center items-center p-4\",children:_jsx(Text,{className:\"text-gray-500 text-center\",children:searchQuery?'Sonuç bulunamadı':'Henüz sohbet yok'})})})]});};export default HomeScreen;","map":{"version":3,"names":["React","useState","useEffect","View","Text","FlatList","TouchableOpacity","TextInput","ActivityIndicator","getDatabase","ref","onValue","push","set","getAuth","database","jsx","_jsx","jsxs","_jsxs","HomeScreen","_ref","navigation","_useState","_useState2","_slicedToArray","chats","setChats","_useState3","_useState4","loading","setLoading","_useState5","_useState6","searchQuery","setSearchQuery","auth","currentUser","navigate","chatsRef","unsubscribe","snapshot","data","val","chatList","Object","entries","filter","_ref2","_ref3","_","chat","participants","uid","map","_ref4","_ref5","id","_objectSpread","lastMessage","messages","values","pop","sort","a","b","timestamp","filteredChats","some","user","email","toLowerCase","includes","renderChatItem","_ref6","item","otherUser","find","className","onPress","chatId","children","text","Date","toLocaleTimeString","hour","minute","size","color","placeholder","value","onChangeText","renderItem","keyExtractor","ListEmptyComponent"],"sources":["C:/Users/BLale/Desktop/Catty/screens/HomeScreen.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  FlatList,\r\n  TouchableOpacity,\r\n  TextInput,\r\n  ActivityIndicator,\r\n} from 'react-native';\r\nimport { getDatabase, ref, onValue, push, set } from 'firebase/database';\r\nimport { getAuth } from 'firebase/auth';\r\nimport { database } from '../config/firebase';\r\n\r\nconst HomeScreen = ({ navigation }) => {\r\n  const [chats, setChats] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n\r\n  useEffect(() => {\r\n    const auth = getAuth();\r\n    const currentUser = auth.currentUser;\r\n    \r\n    if (!currentUser) {\r\n      navigation.navigate('Login');\r\n      return;\r\n    }\r\n\r\n    const chatsRef = ref(database, 'chats');\r\n    const unsubscribe = onValue(chatsRef, (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        const chatList = Object.entries(data)\r\n          .filter(([_, chat]) => chat.participants && chat.participants[currentUser.uid])\r\n          .map(([id, chat]) => ({\r\n            id,\r\n            ...chat,\r\n            lastMessage: chat.messages ? Object.values(chat.messages).pop() : null,\r\n          }))\r\n          .sort((a, b) => {\r\n            if (!a.lastMessage || !b.lastMessage) return 0;\r\n            return b.lastMessage.timestamp - a.lastMessage.timestamp;\r\n          });\r\n        setChats(chatList);\r\n      } else {\r\n        setChats([]);\r\n      }\r\n      setLoading(false);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [navigation]);\r\n\r\n  const filteredChats = chats.filter(chat => \r\n    chat.participants && \r\n    Object.values(chat.participants)\r\n      .some(user => \r\n        user.email && \r\n        user.email.toLowerCase().includes(searchQuery.toLowerCase())\r\n      )\r\n  );\r\n\r\n  const renderChatItem = ({ item }) => {\r\n    const auth = getAuth();\r\n    const currentUser = auth.currentUser;\r\n    const otherUser = Object.values(item.participants).find(\r\n      user => user.uid !== currentUser.uid\r\n    );\r\n\r\n    return (\r\n      <TouchableOpacity\r\n        className=\"bg-surface border-b border-gray-200 p-4\"\r\n        onPress={() => navigation.navigate('Chat', { chatId: item.id, otherUser })}\r\n      >\r\n        <View className=\"flex-row justify-between items-center\">\r\n          <View className=\"flex-1\">\r\n            <Text className=\"text-lg font-semibold text-gray-900\">\r\n              {otherUser?.email || 'Unknown User'}\r\n            </Text>\r\n            {item.lastMessage && (\r\n              <Text className=\"text-gray-600 mt-1\">\r\n                {item.lastMessage.text}\r\n              </Text>\r\n            )}\r\n          </View>\r\n          {item.lastMessage && (\r\n            <Text className=\"text-gray-400 text-sm\">\r\n              {new Date(item.lastMessage.timestamp).toLocaleTimeString([], { \r\n                hour: '2-digit', \r\n                minute: '2-digit' \r\n              })}\r\n            </Text>\r\n          )}\r\n        </View>\r\n      </TouchableOpacity>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <View className=\"flex-1 justify-center items-center bg-surface\">\r\n        <ActivityIndicator size=\"large\" color=\"#007AFF\" />\r\n      </View>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <View className=\"flex-1 bg-surface\">\r\n      <View className=\"p-4\">\r\n        <TextInput\r\n          className=\"bg-background border border-gray-300 rounded-lg px-4 py-3\"\r\n          placeholder=\"Sohbet Ara...\"\r\n          value={searchQuery}\r\n          onChangeText={setSearchQuery}\r\n        />\r\n      </View>\r\n      \r\n      <FlatList\r\n        data={filteredChats}\r\n        renderItem={renderChatItem}\r\n        keyExtractor={item => item.id}\r\n        ListEmptyComponent={\r\n          <View className=\"flex-1 justify-center items-center p-4\">\r\n            <Text className=\"text-gray-500 text-center\">\r\n              {searchQuery ? 'Sonuç bulunamadı' : 'Henüz sohbet yok'}\r\n            </Text>\r\n          </View>\r\n        }\r\n      />\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default HomeScreen; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}